(()=>{"use strict";function e(e){e.classList.remove("popup_is-opened"),document.removeEventListener("keydown",t)}function t(t){if("Escape"===t.key){var n=document.querySelector(".popup_is-opened");n&&e(n)}}function n(e){e.classList.add("popup_is-opened"),document.addEventListener("keydown",t)}function o(e,t,n,o,r,c){var i=n.querySelector(".card").cloneNode(!0),a=i.querySelector(".card__image"),u=i.querySelector(".card__like-counter"),s=i.querySelector(".card__delete-button"),l=i.querySelector(".card__like-button");return a.src=o.link,a.alt="Изображение, отражающее красоту места "+o.name,u.textContent=o.likes.length,i.querySelector(".card__title").textContent=o.name,o.owner._id===t?s.addEventListener("click",(function(){!function(e,t,n,o){t(e,o).then((function(){n.remove()})).catch((function(e){console.log("Ошиба удаления карточки ".concat(e))}))}(e,r.deleteCard,i,o._id)})):s.classList.add("card__delete-button_inactive"),l.addEventListener("click",(function(){!function(e,t,n,o,r){n.classList.contains("card__like-button_is-active")?t.dislikeCard(e,r).then((function(e){n.classList.remove("card__like-button_is-active"),o.textContent=e.likes.length})).catch((function(e){console.log("Ошиба удаления лайка карточки ".concat(e))})):(t.likeCard(e,r).then((function(e){n.classList.add("card__like-button_is-active"),o.textContent=e.likes.length})).catch((function(e){console.log("Ошиба лайка карточки ".concat(e))})),n.classList.add("card__like-button_is-active"))}(e,r,l,u,o._id)})),a.addEventListener("click",(function(){c(o)})),i}function r(e,t,n){t.classList.remove(e.inputErrorClass),n.textContent="",n.classList.remove(e.errorVisibilityClass)}function c(e,t,n){!function(e){return e.some((function(e){return!e.validity.valid}))}(t)?n.classList.remove(e.inactiveButtonClass):n.classList.add(e.inactiveButtonClass)}function i(e,t){Array.from(e.querySelectorAll(t.inputSelector)).forEach((function(n){var o=e.querySelector(".".concat(n.id,"-error"));r(t,n,o)})),e.querySelector(t.submitButtonSelector).classList.add(t.inactiveButtonClass)}function a(e,t){return fetch(e,{headers:{authorization:t.authorization}}).then((function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))}))}function u(e,t){return fetch(e,{method:"DELETE",headers:t}).then((function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))}))}var s,l={formSelector:".popup__form",inputSelector:".popup__input",submitButtonSelector:".popup__button",inactiveButtonClass:"popup__button_disabled",inputErrorClass:"popup__input_type_error",errorVisibilityClass:"popup__error_visible"},d={baseUrl:"https://nomoreparties.co/v1/wff-cohort-22",headers:{authorization:"68a7de7a-4657-4ffc-8eeb-1ef94cb920e6","Content-Type":"application/json"}},p=null,_=null,f=document.querySelector("#card-template").content,m=document.querySelector(".places__list"),y=document.querySelector(".profile__title"),v=document.querySelector(".profile__description"),h=document.querySelector(".profile__image"),S=document.querySelector(".profile__edit-button"),b=document.querySelector(".popup_type_edit"),q=b.querySelector(".popup__form"),k=q.querySelector(".popup__input_type_name"),C=q.querySelector(".popup__input_type_description"),L=document.querySelector(".profile__add-button"),E=document.querySelector(".popup_type_new-card"),g=E.querySelector(".popup__form"),x=g.querySelector(".popup__input_type_card-name"),j=g.querySelector(".popup__input_type_url"),A=document.querySelector(".popup_type_image"),P=A.querySelector(".popup__image"),U=A.querySelector(".popup__caption"),B=document.querySelectorAll(".popup"),w={deleteCard:function(e,t){return u(e.baseUrl+"/cards/"+t,e.headers)},likeCard:function(e,t){return n=e.baseUrl+"/cards/likes/"+t,o=e.headers,fetch(n,{method:"PUT",headers:o}).then((function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))}));var n,o},dislikeCard:function(e,t){return u(e.baseUrl+"/cards/likes/"+t,e.headers)}};function D(e){P.src=e.link,P.alt="Детальное изображение места"+e.name,U.textContent=e.name,n(A)}S.addEventListener("click",(function(){k.value=y.textContent,C.value=v.textContent,i(q,l),n(b)})),L.addEventListener("click",(function(){x.value="",j.value="",i(g,l),n(E)})),q.addEventListener("submit",(function(t){t.preventDefault(),function(e,t){return n=e.baseUrl+"/users/me",o=e.headers,r=t,fetch(n,{method:"PATCH",headers:o,body:JSON.stringify(r)}).then((function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))}));var n,o,r}(d,{name:k.value,about:C.value}).then((function(t){console.log(t),y.textContent=userDetails.name,v.textContent=userDetails.about,e(b)})).catch((function(e){console.log("Ошибка обновления данных пользователя: ".concat(e))}))})),g.addEventListener("submit",(function(t){t.preventDefault(),function(e,t){return n=e.baseUrl+"/cards",o=e.headers,r=t,fetch(n,{method:"POST",headers:o,body:JSON.stringify(r)}).then((function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))}));var n,o,r}(d,{name:x.value,link:j.value}).then((function(n){console.log(n);var r=o(d,p._id,f,n,w,D);m.prepend(r),t.target.reset(),e(E)}))})),B.forEach((function(t){t.addEventListener("click",(function(n){n.target.classList.contains("popup")&&e(t)})),t.querySelector(".popup__close").addEventListener("click",(function(){e(t)}))})),function(e){Array.from(document.querySelectorAll(e.formSelector)).forEach((function(t){var n,o,i,a,u=Array.from(t.querySelectorAll(e.inputSelector)),s=t.querySelector(e.submitButtonSelector);o=t,c(n=e,i=u,a=s),i.forEach((function(e){var t=o.querySelector(".".concat(e.id,"-error"));e.addEventListener("input",(function(){c(n,i,a),function(e,t,n){t.validity.valid?r(e,t,n):(t.validity.patternMismatch?t.setCustomValidity(t.dataset.errorMessage):t.setCustomValidity(""),function(e,t,n,o){t.classList.add(e.inputErrorClass),n.textContent=o,n.classList.add(e.errorVisibilityClass)}(e,t,n,t.validationMessage))}(n,e,t)}))}))}))}(l),Promise.all([(s=d,a(s.baseUrl+"/users/me",s.headers)),function(e){return a(e.baseUrl+"/cards",e.headers)}(d)]).then((function(e){var t;p=e[0],_=Array.from(e[1]),t=p,y.textContent=t.name,v.textContent=t.about,h.src=t.avatar,function(e,t){e.forEach((function(e){var n=o(d,t._id,f,e,w,D);m.append(n)}))}(_,p)})).catch((function(e){console.log("Ошибка загрузки данных: ".concat(e))}))})();