(()=>{"use strict";function e(e){e.classList.remove("popup_is-opened"),document.removeEventListener("keydown",t)}function t(t){if("Escape"===t.key){var n=document.querySelector(".popup_is-opened");n&&e(n)}}function n(e){e.classList.add("popup_is-opened"),document.addEventListener("keydown",t)}function o(e,t,n,o,r,c,i){var u=function(e){return e.querySelector(".card").cloneNode(!0)}(n),a=u.querySelector(".card__image"),l=u.querySelector(".card__like-counter"),s=u.querySelector(".card__delete-button"),d=u.querySelector(".card__like-button");return a.src=o.link,a.alt="Изображение, отражающее красоту места "+o.name,l.textContent=o.likes.length,function(e,t){var n=!1;return t.forEach((function(t){t._id===e&&(n=!0)})),n}(t,o.likes)&&d.classList.add("card__like-button_is-active"),u.querySelector(".card__title").textContent=o.name,o.owner._id===t?s.addEventListener("click",(function(){i(u,o._id)})):s.classList.add("card__delete-button_inactive"),d.addEventListener("click",(function(){!function(e,t,n,o,r){n.classList.contains("card__like-button_is-active")?t.removeLike(e,r).then((function(e){n.classList.remove("card__like-button_is-active"),o.textContent=e.likes.length})).catch((function(e){console.log("Ошибка удаления лайка карточки ".concat(e))})):t.addLike(e,r).then((function(e){n.classList.add("card__like-button_is-active"),o.textContent=e.likes.length})).catch((function(e){console.log("Ошибка лайка карточки ".concat(e))}))}(e,r,d,l,o._id)})),a.addEventListener("click",(function(){c(o)})),u}function r(e,t,n){t.classList.remove(e.inputErrorClass),t.setCustomValidity(""),n.textContent="",n.classList.remove(e.errorVisibilityClass)}function c(e,t,n){!function(e){return e.some((function(e){return!e.validity.valid}))}(t)?n.classList.remove(e.inactiveButtonClass):n.classList.add(e.inactiveButtonClass)}function i(e,t){Array.from(e.querySelectorAll(t.inputSelector)).forEach((function(n){var o=e.querySelector(".".concat(n.id,"-error"));r(t,n,o)})),e.querySelector(t.submitButtonSelector).classList.add(t.inactiveButtonClass)}function u(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))}function a(e,t){return fetch(e,{headers:{authorization:t.authorization}}).then((function(e){return u(e)}))}function l(e,t,n){return fetch(e,{method:"PATCH",headers:t,body:JSON.stringify(n)}).then((function(e){return u(e)}))}function s(e,t){return fetch(e,{method:"DELETE",headers:t}).then((function(e){return u(e)}))}var d={getCards:function(e){return a(e.baseUrl+"/cards",e.headers)},addNewCard:function(e,t){return n=e.baseUrl+"/cards",o=e.headers,r=t,fetch(n,{method:"POST",headers:o,body:JSON.stringify(r)}).then((function(e){return u(e)}));var n,o,r},deleteCard:function(e,t){return s(e.baseUrl+"/cards/"+t,e.headers)},addLike:function(e,t){return n=e.baseUrl+"/cards/likes/"+t,o=e.headers,fetch(n,{method:"PUT",headers:o}).then((function(e){return u(e)}));var n,o},removeLike:function(e,t){return s(e.baseUrl+"/cards/likes/"+t,e.headers)}};function p(e,t){e.querySelector(".popup__button").textContent=t?"Сохранение...":"Сохранить"}var f,_={formSelector:".popup__form",inputSelector:".popup__input",submitButtonSelector:".popup__button",inactiveButtonClass:"popup__button_disabled",inputErrorClass:"popup__input_type_error",errorVisibilityClass:"popup__error_visible"},m={baseUrl:"https://nomoreparties.co/v1/wff-cohort-22",headers:{authorization:"68a7de7a-4657-4ffc-8eeb-1ef94cb920e6","Content-Type":"application/json"}},y=null,v=null,h=document.querySelector("#card-template").content,S=document.querySelector(".places__list"),b=document.querySelector(".profile__title"),q=document.querySelector(".profile__description"),C=document.querySelector(".profile__image"),L=document.querySelector(".profile__edit-button"),k=document.querySelector(".popup_type_edit"),E=k.querySelector(".popup__form"),g=E.querySelector(".popup__input_type_name"),x=E.querySelector(".popup__input_type_description"),U=document.querySelector(".profile__image_edit-button"),A=document.querySelector(".popup_type_avatar"),w=A.querySelector(".popup__form"),B=A.querySelector(".popup__input_type_url"),V=document.querySelector(".profile__add-button"),D=document.querySelector(".popup_type_new-card"),N=D.querySelector(".popup__form"),P=N.querySelector(".popup__input_type_card-name"),T=N.querySelector(".popup__input_type_url"),j=document.querySelector(".popup_type_delete-card"),z=j.querySelector(".popup__form"),M={element:null,id:null},O=document.querySelector(".popup_type_image"),J=O.querySelector(".popup__image"),H=O.querySelector(".popup__caption"),F=document.querySelectorAll(".popup");function G(e){J.src=e.link,J.alt="Детальное изображение места"+e.name,H.textContent=e.name,n(O)}function I(e,t){M.element=e,M.id=t,n(j)}L.addEventListener("click",(function(){g.value=b.textContent,x.value=q.textContent,i(E,_),n(k)})),U.addEventListener("click",(function(){n(A)})),V.addEventListener("click",(function(){n(D)})),E.addEventListener("submit",(function(t){var n,o;t.preventDefault(),p(E,!0),(n=m,o={name:g.value,about:x.value},l(n.baseUrl+"/users/me",n.headers,o)).then((function(t){b.textContent=t.name,q.textContent=t.about,e(k)})).catch((function(e){console.log("Ошибка обновления данных пользователя: ".concat(e))})).finally((function(){p(E,!1)}))})),w.addEventListener("submit",(function(t){var n,o;t.preventDefault(),p(w,!0),(n=m,o={avatar:B.value},l(n.baseUrl+"/users/me/avatar",n.headers,o)).then((function(t){C.src=t.avatar,B.value="",i(w,_),e(A)})).catch((function(e){console.log("Ошибка обновления аватара: ".concat(e))})).finally((function(){p(w,!1)}))})),N.addEventListener("submit",(function(t){t.preventDefault(),p(N,!0),d.addNewCard(m,{name:P.value,link:T.value}).then((function(n){var r=o(m,y._id,h,n,d,G,I);S.prepend(r),t.target.reset(),P.value="",T.value="",i(N,_),e(D)})).catch((function(e){console.log("Ошибка добавления карточки: ".concat(e))})).finally((function(){p(N,!1)}))})),z.addEventListener("submit",(function(t){t.preventDefault(),null!==M.element&&null!==M.id&&function(e,t,n,o,r){t.deleteCard(e,n.id).then((function(e){n.element.remove(),n.element=null,n.id=null,r(o)})).catch((function(e){console.log("Ошибка удаления карточки ".concat(e))}))}(m,d,M,j,e)})),F.forEach((function(t){t.addEventListener("click",(function(n){n.target.classList.contains("popup")&&e(t)})),t.querySelector(".popup__close").addEventListener("click",(function(){e(t)}))})),function(e){Array.from(document.querySelectorAll(e.formSelector)).forEach((function(t){var n,o,i,u,a=Array.from(t.querySelectorAll(e.inputSelector)),l=t.querySelector(e.submitButtonSelector);o=t,c(n=e,i=a,u=l),i.forEach((function(e){var t=o.querySelector(".".concat(e.id,"-error"));e.addEventListener("input",(function(){c(n,i,u),function(e,t,n){t.validity.valid?r(e,t,n):(t.validity.patternMismatch?t.setCustomValidity(t.dataset.errorMessage):t.setCustomValidity(""),function(e,t,n,o){t.classList.add(e.inputErrorClass),n.textContent=o,n.classList.add(e.errorVisibilityClass)}(e,t,n,t.validationMessage))}(n,e,t)}))}))}))}(_),Promise.all([(f=m,a(f.baseUrl+"/users/me",f.headers)),d.getCards(m)]).then((function(e){var t;y=e[0],v=Array.from(e[1]),t=y,b.textContent=t.name,q.textContent=t.about,C.src=t.avatar,function(e,t){e.forEach((function(e){var n=o(m,t._id,h,e,d,G,I);S.append(n)}))}(v,y)})).catch((function(e){console.log("Ошибка загрузки данных: ".concat(e))}))})();