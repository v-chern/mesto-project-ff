(()=>{"use strict";function e(e){e.classList.remove("popup_is-opened"),document.removeEventListener("keydown",t)}function t(t){if("Escape"===t.key){var n=document.querySelector(".popup_is-opened");n&&e(n)}}function n(e){e.classList.add("popup_is-opened"),document.addEventListener("keydown",t)}function o(e,t,n,o,r,c,i){var u=n.querySelector(".card").cloneNode(!0),a=u.querySelector(".card__image"),l=u.querySelector(".card__like-counter"),s=u.querySelector(".card__delete-button"),d=u.querySelector(".card__like-button");return a.src=o.link,a.alt="Изображение, отражающее красоту места "+o.name,l.textContent=o.likes.length,function(e,t){var n=!1;return t.forEach((function(t){t._id===e&&(n=!0)})),n}(t,o.likes)&&d.classList.add("card__like-button_is-active"),u.querySelector(".card__title").textContent=o.name,o.owner._id===t?s.addEventListener("click",(function(){i(u,o._id)})):s.classList.add("card__delete-button_inactive"),d.addEventListener("click",(function(){!function(e,t,n,o,r){n.classList.contains("card__like-button_is-active")?t.removeLike(e,r).then((function(e){n.classList.remove("card__like-button_is-active"),o.textContent=e.likes.length})).catch((function(e){console.log("Ошибка удаления лайка карточки ".concat(e))})):t.addLike(e,r).then((function(e){n.classList.add("card__like-button_is-active"),o.textContent=e.likes.length})).catch((function(e){console.log("Ошибка лайка карточки ".concat(e))}))}(e,r,d,l,o._id)})),a.addEventListener("click",(function(){c(o)})),u}function r(e,t,n){t.classList.remove(e.inputErrorClass),t.setCustomValidity(""),n.textContent="",n.classList.remove(e.errorVisibilityClass)}function c(e,t,n){!function(e){return e.some((function(e){return!e.validity.valid}))}(t)?n.classList.remove(e.inactiveButtonClass):n.classList.add(e.inactiveButtonClass)}function i(e,t){Array.from(e.querySelectorAll(t.inputSelector)).forEach((function(n){var o=e.querySelector(".".concat(n.id,"-error"));r(t,n,o)})),e.querySelector(t.submitButtonSelector).classList.add(t.inactiveButtonClass)}function u(e,t){return fetch(e,{headers:{authorization:t.authorization}}).then((function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))}))}function a(e,t,n){return fetch(e,{method:"PATCH",headers:t,body:JSON.stringify(n)}).then((function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))}))}function l(e,t){return fetch(e,{method:"DELETE",headers:t}).then((function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))}))}var s={getCards:function(e){return u(e.baseUrl+"/cards",e.headers)},addNewCard:function(e,t){return n=e.baseUrl+"/cards",o=e.headers,r=t,fetch(n,{method:"POST",headers:o,body:JSON.stringify(r)}).then((function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))}));var n,o,r},deleteCard:function(e,t){return l(e.baseUrl+"/cards/"+t,e.headers)},addLike:function(e,t){return n=e.baseUrl+"/cards/likes/"+t,o=e.headers,fetch(n,{method:"PUT",headers:o}).then((function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))}));var n,o},removeLike:function(e,t){return l(e.baseUrl+"/cards/likes/"+t,e.headers)}};function d(e,t){e.querySelector(".popup__button").textContent=t?"Сохранение...":"Сохранить"}var p,f={formSelector:".popup__form",inputSelector:".popup__input",submitButtonSelector:".popup__button",inactiveButtonClass:"popup__button_disabled",inputErrorClass:"popup__input_type_error",errorVisibilityClass:"popup__error_visible"},_={baseUrl:"https://nomoreparties.co/v1/wff-cohort-22",headers:{authorization:"68a7de7a-4657-4ffc-8eeb-1ef94cb920e6","Content-Type":"application/json"}},m=null,y=null,v=document.querySelector("#card-template").content,h=document.querySelector(".places__list"),S=document.querySelector(".profile__title"),b=document.querySelector(".profile__description"),q=document.querySelector(".profile__image"),k=document.querySelector(".profile__edit-button"),C=document.querySelector(".popup_type_edit"),L=C.querySelector(".popup__form"),E=L.querySelector(".popup__input_type_name"),g=L.querySelector(".popup__input_type_description"),x=document.querySelector(".profile__image_edit-button"),j=document.querySelector(".popup_type_avatar"),U=j.querySelector(".popup__form"),A=j.querySelector(".popup__input_type_url"),P=document.querySelector(".profile__add-button"),w=document.querySelector(".popup_type_new-card"),B=w.querySelector(".popup__form"),V=B.querySelector(".popup__input_type_card-name"),D=B.querySelector(".popup__input_type_url"),N=document.querySelector(".popup_type_delete-card"),T=N.querySelector(".popup__form"),z={element:null,id:null},M=document.querySelector(".popup_type_image"),O=M.querySelector(".popup__image"),J=M.querySelector(".popup__caption"),H=document.querySelectorAll(".popup");function F(e){O.src=e.link,O.alt="Детальное изображение места"+e.name,J.textContent=e.name,n(M)}function G(e,t){z.element=e,z.id=t,n(N)}k.addEventListener("click",(function(){E.value=S.textContent,g.value=b.textContent,i(L,f),n(C)})),x.addEventListener("click",(function(){n(j)})),P.addEventListener("click",(function(){n(w)})),L.addEventListener("submit",(function(t){var n,o;t.preventDefault(),d(L,!0),(n=_,o={name:E.value,about:g.value},a(n.baseUrl+"/users/me",n.headers,o)).then((function(t){S.textContent=t.name,b.textContent=t.about,e(C)})).catch((function(e){console.log("Ошибка обновления данных пользователя: ".concat(e))})).finally((function(){d(L,!1)}))})),U.addEventListener("submit",(function(t){var n,o;t.preventDefault(),d(U,!0),(n=_,o={avatar:A.value},a(n.baseUrl+"/users/me/avatar",n.headers,o)).then((function(t){q.src=t.avatar,A.value="",i(U,f),e(j)})).catch((function(e){console.log("Ошибка обновления аватара: ".concat(e))})).finally((function(){d(U,!1)}))})),B.addEventListener("submit",(function(t){t.preventDefault(),d(B,!0),s.addNewCard(_,{name:V.value,link:D.value}).then((function(n){var r=o(_,m._id,v,n,s,F,G);h.prepend(r),t.target.reset(),V.value="",D.value="",i(B,f),e(w)})).catch((function(e){console.log("Ошибка добавления карточки: ".concat(e))})).finally((function(){d(B,!1)}))})),T.addEventListener("submit",(function(t){t.preventDefault(),null!==z.element&&null!==z.id&&function(e,t,n,o,r){t.deleteCard(e,n.id).then((function(e){n.element.remove(),n.element=null,n.id=null,r(o)})).catch((function(e){console.log("Ошибка удаления карточки ".concat(e))}))}(_,s,z,N,e)})),H.forEach((function(t){t.addEventListener("click",(function(n){n.target.classList.contains("popup")&&e(t)})),t.querySelector(".popup__close").addEventListener("click",(function(){e(t)}))})),function(e){Array.from(document.querySelectorAll(e.formSelector)).forEach((function(t){var n,o,i,u,a=Array.from(t.querySelectorAll(e.inputSelector)),l=t.querySelector(e.submitButtonSelector);o=t,c(n=e,i=a,u=l),i.forEach((function(e){var t=o.querySelector(".".concat(e.id,"-error"));e.addEventListener("input",(function(){c(n,i,u),function(e,t,n){t.validity.valid?r(e,t,n):(t.validity.patternMismatch?t.setCustomValidity(t.dataset.errorMessage):t.setCustomValidity(""),function(e,t,n,o){t.classList.add(e.inputErrorClass),n.textContent=o,n.classList.add(e.errorVisibilityClass)}(e,t,n,t.validationMessage))}(n,e,t)}))}))}))}(f),Promise.all([(p=_,u(p.baseUrl+"/users/me",p.headers)),s.getCards(_)]).then((function(e){var t;m=e[0],y=Array.from(e[1]),t=m,S.textContent=t.name,b.textContent=t.about,q.src=t.avatar,function(e,t){e.forEach((function(e){var n=o(_,t._id,v,e,s,F,G);h.append(n)}))}(y,m)})).catch((function(e){console.log("Ошибка загрузки данных: ".concat(e))}))})();